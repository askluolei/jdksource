<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1130px" preserveAspectRatio="none" style="width:5116px;height:1130px;" version="1.1" viewBox="0 0 5116 1130" width="5116px" zoomAndPan="magnify"><defs><filter height="300%" id="fpicdn1crim74" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class Principal--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="Principal" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="1776.5" y="15.5"/><ellipse cx="1805" cy="31.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1801.5938,25.7813 L1801.5938,25.375 L1807.9063,25.375 L1807.9063,25.7813 L1805.375,25.7813 Q1805.375,25.7813 1805.5234,25.9141 Q1805.6719,26.0469 1805.6719,26.3125 L1805.6719,35.7969 Q1805.6719,36.0625 1805.8906,36.1953 Q1806.1094,36.3281 1806.1094,36.3281 L1807.9063,36.3281 L1807.9063,36.7344 L1801.5938,36.7344 L1801.5938,36.3281 L1803.125,36.3281 Q1803.4531,36.3281 1803.5859,36.1953 Q1803.7188,36.0625 1803.7188,35.7969 L1803.7188,26.3125 Q1803.7188,26.0469 1803.5859,25.9141 Q1803.4531,25.7813 1803.125,25.7813 L1801.5938,25.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="48" x="1822" y="37.0576">Principal</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1777.5" x2="1885.5" y1="47.5" y2="47.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1777.5" x2="1885.5" y1="55.5" y2="55.5"/><ellipse cx="1787.5" cy="68.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="1796.5" y="72.106">getName(): String</text><path d="M1645,201 L1645,228.7544 A0,0 0 0 0 1645,228.7544 L1770,228.7544 A0,0 0 0 0 1770,228.7544 L1770,211 L1760,201 L1721.31,201 L1808.47,78.83 L1713.31,201 L1645,201 A0,0 0 0 0 1645,201 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1760,201 L1760,211 L1770,211 L1760,201 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1651" y="220.8979">这里通常是用户名</text><!--class GrantedAuthority--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="GrantedAuthority" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="2439" y="15.5"/><ellipse cx="2455.35" cy="31.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2451.9438,25.7813 L2451.9438,25.375 L2458.2563,25.375 L2458.2563,25.7813 L2455.725,25.7813 Q2455.725,25.7813 2455.8734,25.9141 Q2456.0219,26.0469 2456.0219,26.3125 L2456.0219,35.7969 Q2456.0219,36.0625 2456.2406,36.1953 Q2456.4594,36.3281 2456.4594,36.3281 L2458.2563,36.3281 L2458.2563,36.7344 L2451.9438,36.7344 L2451.9438,36.3281 L2453.475,36.3281 Q2453.8031,36.3281 2453.9359,36.1953 Q2454.0688,36.0625 2454.0688,35.7969 L2454.0688,26.3125 Q2454.0688,26.0469 2453.9359,25.9141 Q2453.8031,25.7813 2453.475,25.7813 L2451.9438,25.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="92" x="2469.65" y="37.0576">GrantedAuthority</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2440" x2="2565" y1="47.5" y2="47.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2440" x2="2565" y1="55.5" y2="55.5"/><ellipse cx="2450" cy="68.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="101" x="2459" y="72.106">getAuthority(): String</text><path d="M3140.5,201 L3140.5,228.7544 L3514.5,228.7544 L3514.5,211 L3504.5,201 L3140.5,201 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3504.5,201 L3504.5,211 L3514.5,211 L3504.5,201 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="3146.5" y="220.8979">字符串形式的权限表达式，不过在 spring-security 里面是角色</text><!--class Authentication--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="138.1377" id="Authentication" style="stroke: #A80036; stroke-width: 1.5;" width="299" x="1805" y="146"/><ellipse cx="1911.25" cy="162" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1907.8438,156.2813 L1907.8438,155.875 L1914.1563,155.875 L1914.1563,156.2813 L1911.625,156.2813 Q1911.625,156.2813 1911.7734,156.4141 Q1911.9219,156.5469 1911.9219,156.8125 L1911.9219,166.2969 Q1911.9219,166.5625 1912.1406,166.6953 Q1912.3594,166.8281 1912.3594,166.8281 L1914.1563,166.8281 L1914.1563,167.2344 L1907.8438,167.2344 L1907.8438,166.8281 L1909.375,166.8281 Q1909.7031,166.8281 1909.8359,166.6953 Q1909.9688,166.5625 1909.9688,166.2969 L1909.9688,156.8125 Q1909.9688,156.5469 1909.8359,156.4141 Q1909.7031,156.2813 1909.375,156.2813 L1907.8438,156.2813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="78" x="1931.75" y="167.5576">Authentication</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1806" x2="2103" y1="178" y2="178"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1806" x2="2103" y1="186" y2="186"/><ellipse cx="1816" cy="199.0115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="273" x="1825" y="202.606">getAuthorities(): Collection&lt;? extends GrantedAuthority&gt;</text><ellipse cx="1816" cy="214.0344" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="114" x="1825" y="217.6289">getCredentials(): Object</text><ellipse cx="1816" cy="229.0574" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="92" x="1825" y="232.6519">getDetails(): Object</text><ellipse cx="1816" cy="244.0803" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="1825" y="247.6748">getPrincipal(): Object</text><ellipse cx="1816" cy="259.1033" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="127" x="1825" y="262.6978">isAuthenticated(): boolean</text><ellipse cx="1816" cy="274.1262" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="206" x="1825" y="277.7207">setAuthenticated(boolean isAuthenticated)</text><path d="M1594.5,406.5 L1594.5,434.2544 A0,0 0 0 0 1594.5,434.2544 L2174.5,434.2544 A0,0 0 0 0 2174.5,434.2544 L2174.5,416.5 L2164.5,406.5 L1893.05,406.5 L1931.09,284.045 L1885.05,406.5 L1594.5,406.5 A0,0 0 0 0 1594.5,406.5 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2164.5,406.5 L2164.5,416.5 L2174.5,416.5 L2164.5,406.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="559" x="1600.5" y="426.3979">这个类，可以代表用户传过来的凭证（用户名密码之类的），也是认证处理过后的内部使用的凭证</text><!--class AuthenticationManager--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="AuthenticationManager" style="stroke: #A80036; stroke-width: 1.5;" width="307" x="922" y="579.5"/><ellipse cx="1008.25" cy="595.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1004.8438,589.7813 L1004.8438,589.375 L1011.1563,589.375 L1011.1563,589.7813 L1008.625,589.7813 Q1008.625,589.7813 1008.7734,589.9141 Q1008.9219,590.0469 1008.9219,590.3125 L1008.9219,599.7969 Q1008.9219,600.0625 1009.1406,600.1953 Q1009.3594,600.3281 1009.3594,600.3281 L1011.1563,600.3281 L1011.1563,600.7344 L1004.8438,600.7344 L1004.8438,600.3281 L1006.375,600.3281 Q1006.7031,600.3281 1006.8359,600.1953 Q1006.9688,600.0625 1006.9688,599.7969 L1006.9688,590.3125 Q1006.9688,590.0469 1006.8359,589.9141 Q1006.7031,589.7813 1006.375,589.7813 L1004.8438,589.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="126" x="1028.75" y="601.0576">AuthenticationManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="923" x2="1228" y1="611.5" y2="611.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="923" x2="1228" y1="619.5" y2="619.5"/><ellipse cx="933" cy="632.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="281" x="942" y="636.106">authenticate(Authentication authentication): Authentication</text><path d="M6,795 L6,822.7544 L391,822.7544 L391,805 L381,795 L6,795 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M381,795 L381,805 L391,805 L381,795 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="12" y="814.8979">认证管理，就是判断传过来的凭证是否有效，通常不会自己实现</text><!--class AuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="AuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="307" x="1921" y="572"/><ellipse cx="2008.25" cy="588" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2004.8438,582.2813 L2004.8438,581.875 L2011.1563,581.875 L2011.1563,582.2813 L2008.625,582.2813 Q2008.625,582.2813 2008.7734,582.4141 Q2008.9219,582.5469 2008.9219,582.8125 L2008.9219,592.2969 Q2008.9219,592.5625 2009.1406,592.6953 Q2009.3594,592.8281 2009.3594,592.8281 L2011.1563,592.8281 L2011.1563,593.2344 L2004.8438,593.2344 L2004.8438,592.8281 L2006.375,592.8281 Q2006.7031,592.8281 2006.8359,592.6953 Q2006.9688,592.5625 2006.9688,592.2969 L2006.9688,582.8125 Q2006.9688,582.5469 2006.8359,582.4141 Q2006.7031,582.2813 2006.375,582.2813 L2004.8438,582.2813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="124" x="2028.75" y="593.5576">AuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1922" x2="2227" y1="604" y2="604"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1922" x2="2227" y1="612" y2="612"/><ellipse cx="1932" cy="625.0115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="281" x="1941" y="628.606">authenticate(Authentication authentication): Authentication</text><ellipse cx="1932" cy="640.0344" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="210" x="1941" y="643.6289">supports(Class&lt;?&gt; authentication): boolean</text><path d="M2226,795 L2226,822.7544 A0,0 0 0 0 2226,822.7544 L2689,822.7544 A0,0 0 0 0 2689,822.7544 L2689,805 L2679,795 L2435.71,795 L2148.8,650.023 L2427.71,795 L2226,795 A0,0 0 0 0 2226,795 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2679,795 L2679,805 L2689,805 L2679,795 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="442" x="2232" y="814.8979">认证提供类，由于凭证可以是各种类型，每个提供者处理自己支持的凭证类型</text><!--class ProviderManager--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="ProviderManager" style="stroke: #A80036; stroke-width: 1.5;" width="216" x="967.5" y="770"/><ellipse cx="1024.75" cy="786" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1023.3281,791.3594 Q1021.4688,791.3594 1020.375,789.9688 Q1019.2813,788.5781 1019.2813,785.5938 Q1019.2813,783.0625 1020.4453,781.4063 Q1021.6094,779.75 1023.5938,779.75 Q1025.0625,779.75 1025.5313,779.875 Q1026,780.0781 1026,780.0781 Q1026,780.0781 1026,780.0078 Q1026,779.9375 1026.6094,779.0156 L1027.6563,782.6719 L1026.3281,783.0781 Q1025.8594,781.5313 1025.1953,780.8672 Q1024.5313,780.2031 1023.4688,780.2031 Q1023.0781,780.2031 1022.3125,781.7344 Q1021.5469,783.2656 1021.5469,785.5156 Q1021.5469,787.9844 1022.2109,789.375 Q1022.875,790.7656 1023.4063,790.7656 Q1024.4688,790.7656 1025.2266,790 Q1025.9844,789.2344 1026.3281,787.5781 L1027.6563,788.1719 Q1027.3281,789.5781 1026.4297,790.4688 Q1025.5313,791.3594 1023.3281,791.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="93" x="1045.25" y="791.5576">ProviderManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="968.5" x2="1182.5" y1="802" y2="802"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="975.5" y="812.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="190" x="987.5" y="818.606">providers: List&lt;AuthenticationProvider&gt;</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="975.5" y="827.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="987.5" y="833.6289">parent: AuthenticationManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="968.5" x2="1182.5" y1="840.0459" y2="840.0459"/><path d="M731.5,978 L731.5,1005.7544 A0,0 0 0 0 731.5,1005.7544 L1419.5,1005.7544 A0,0 0 0 0 1419.5,1005.7544 L1419.5,988 L1409.5,978 L1079.5,978 L1075.5,848.385 L1071.5,978 L731.5,978 A0,0 0 0 0 731.5,978 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1409.5,978 L1409.5,988 L1419.5,988 L1409.5,978 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="667" x="737.5" y="997.8979">这个就是认证管理的内部实现，我们自定义的是 认证提供，用来处理自定义凭证，如果没有自定义，那也不用管这里</text><!--class CredentialsContainer--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="CredentialsContainer" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="2300" y="183.5"/><ellipse cx="2315" cy="199.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2311.5938,193.7813 L2311.5938,193.375 L2317.9063,193.375 L2317.9063,193.7813 L2315.375,193.7813 Q2315.375,193.7813 2315.5234,193.9141 Q2315.6719,194.0469 2315.6719,194.3125 L2315.6719,203.7969 Q2315.6719,204.0625 2315.8906,204.1953 Q2316.1094,204.3281 2316.1094,204.3281 L2317.9063,204.3281 L2317.9063,204.7344 L2311.5938,204.7344 L2311.5938,204.3281 L2313.125,204.3281 Q2313.4531,204.3281 2313.5859,204.1953 Q2313.7188,204.0625 2313.7188,203.7969 L2313.7188,194.3125 Q2313.7188,194.0469 2313.5859,193.9141 Q2313.4531,193.7813 2313.125,193.7813 L2311.5938,193.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="117" x="2329" y="205.0576">CredentialsContainer</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2301" x2="2448" y1="215.5" y2="215.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2301" x2="2448" y1="223.5" y2="223.5"/><ellipse cx="2311" cy="236.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="2320" y="240.106">eraseCredentials()</text><!--class AbstractAuthenticationToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="93.0688" id="AbstractAuthenticationToken" style="stroke: #A80036; stroke-width: 1.5;" width="223" x="2281" y="374"/><ellipse cx="2310.85" cy="390" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2311.225,389.9844 L2309.2406,389.9844 L2308.6469,392.5 Q2308.5844,392.8438 2308.5844,393.0313 Q2308.5844,393.2969 2308.6781,393.5625 Q2308.7719,393.8281 2308.7719,393.8281 L2309.4438,393.8281 L2309.4438,394.2344 L2305.9906,394.2344 L2305.9906,393.8281 L2306.1781,393.8281 Q2306.4438,393.8281 2306.6469,393.6641 Q2306.85,393.5 2306.9125,393.1094 L2309.5063,382.9375 L2311.3813,382.3281 L2314.0219,393.1094 Q2314.1625,393.5 2314.3578,393.6641 Q2314.5531,393.8281 2314.5531,393.8281 L2315.0219,393.8281 L2315.0219,394.2344 L2311.1625,394.2344 L2311.1625,393.8281 L2311.4281,393.8281 Q2311.8344,393.8281 2311.8969,393.6641 Q2311.9594,393.5 2311.9594,393.375 Q2311.9594,393.1094 2311.8969,392.9063 L2311.225,389.9844 Z M2309.8344,384.0781 L2309.8344,384.0781 L2309.3813,389.5781 L2311.1625,389.5781 L2309.8344,384.0781 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="158" x="2328.15" y="395.5576">AbstractAuthenticationToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2282" x2="2503" y1="406" y2="406"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2289" y="416.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="197" x="2301" y="422.606">authorities: Collection&lt;GrantedAuthority&gt;</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2289" y="431.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="68" x="2301" y="437.6289">details: Object</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2289" y="446.0574"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="109" x="2301" y="452.6519">authenticated: boolean</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2282" x2="2503" y1="459.0688" y2="459.0688"/><path d="M2556.5,597 L2556.5,624.7544 A0,0 0 0 0 2556.5,624.7544 L3084.5,624.7544 A0,0 0 0 0 3084.5,624.7544 L3084.5,607 L3074.5,597 L2794.88,597 L2495.83,467.01 L2786.88,597 L2556.5,597 A0,0 0 0 0 2556.5,597 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3074.5,597 L3074.5,607 L3084.5,607 L3074.5,597 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="507" x="2562.5" y="616.8979">这个是抽象的凭证类实现，凭证里面有权限（角色），明细（额外信息），是否认证通过</text><!--class RememberMeAuthenticationToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="RememberMeAuthenticationToken" style="stroke: #A80036; stroke-width: 1.5;" width="222" x="1663.5" y="572"/><ellipse cx="1678.5" cy="588" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1677.0781,593.3594 Q1675.2188,593.3594 1674.125,591.9688 Q1673.0313,590.5781 1673.0313,587.5938 Q1673.0313,585.0625 1674.1953,583.4063 Q1675.3594,581.75 1677.3438,581.75 Q1678.8125,581.75 1679.2813,581.875 Q1679.75,582.0781 1679.75,582.0781 Q1679.75,582.0781 1679.75,582.0078 Q1679.75,581.9375 1680.3594,581.0156 L1681.4063,584.6719 L1680.0781,585.0781 Q1679.6094,583.5313 1678.9453,582.8672 Q1678.2813,582.2031 1677.2188,582.2031 Q1676.8281,582.2031 1676.0625,583.7344 Q1675.2969,585.2656 1675.2969,587.5156 Q1675.2969,589.9844 1675.9609,591.375 Q1676.625,592.7656 1677.1563,592.7656 Q1678.2188,592.7656 1678.9766,592 Q1679.7344,591.2344 1680.0781,589.5781 L1681.4063,590.1719 Q1681.0781,591.5781 1680.1797,592.4688 Q1679.2813,593.3594 1677.0781,593.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="190" x="1692.5" y="593.5576">RememberMeAuthenticationToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1664.5" x2="1884.5" y1="604" y2="604"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1671.5" y="614.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="1683.5" y="620.606">keyHash: int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1671.5" y="629.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="1683.5" y="635.6289">principal: Object</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1664.5" x2="1884.5" y1="642.0459" y2="642.0459"/><path d="M1218.5,795 L1218.5,822.7544 A0,0 0 0 0 1218.5,822.7544 L1672.5,822.7544 A0,0 0 0 0 1672.5,822.7544 L1672.5,805 L1662.5,795 L1471.65,795 L1710.68,650.023 L1463.65,795 L1218.5,795 A0,0 0 0 0 1218.5,795 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1662.5,795 L1662.5,805 L1672.5,805 L1662.5,795 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="1224.5" y="814.8979">跟 RememberMeAuthenticationProvider 是配套的，判断 keyHash 是否相同</text><!--class RememberMeAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="RememberMeAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="233" x="1958" y="770"/><ellipse cx="1973" cy="786" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1971.5781,791.3594 Q1969.7188,791.3594 1968.625,789.9688 Q1967.5313,788.5781 1967.5313,785.5938 Q1967.5313,783.0625 1968.6953,781.4063 Q1969.8594,779.75 1971.8438,779.75 Q1973.3125,779.75 1973.7813,779.875 Q1974.25,780.0781 1974.25,780.0781 Q1974.25,780.0781 1974.25,780.0078 Q1974.25,779.9375 1974.8594,779.0156 L1975.9063,782.6719 L1974.5781,783.0781 Q1974.1094,781.5313 1973.4453,780.8672 Q1972.7813,780.2031 1971.7188,780.2031 Q1971.3281,780.2031 1970.5625,781.7344 Q1969.7969,783.2656 1969.7969,785.5156 Q1969.7969,787.9844 1970.4609,789.375 Q1971.125,790.7656 1971.6563,790.7656 Q1972.7188,790.7656 1973.4766,790 Q1974.2344,789.2344 1974.5781,787.5781 L1975.9063,788.1719 Q1975.5781,789.5781 1974.6797,790.4688 Q1973.7813,791.3594 1971.5781,791.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="201" x="1987" y="791.5576">RememberMeAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1959" x2="2190" y1="802" y2="802"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1966" y="812.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="1978" y="818.606">keyHash: int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1966" y="827.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="1978" y="833.6289">principal: Object</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1959" x2="2190" y1="840.0459" y2="840.0459"/><!--class AnonymousAuthenticationToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="AnonymousAuthenticationToken" style="stroke: #A80036; stroke-width: 1.5;" width="208" x="3119.5" y="572"/><ellipse cx="3134.5" cy="588" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3133.0781,593.3594 Q3131.2188,593.3594 3130.125,591.9688 Q3129.0313,590.5781 3129.0313,587.5938 Q3129.0313,585.0625 3130.1953,583.4063 Q3131.3594,581.75 3133.3438,581.75 Q3134.8125,581.75 3135.2813,581.875 Q3135.75,582.0781 3135.75,582.0781 Q3135.75,582.0781 3135.75,582.0078 Q3135.75,581.9375 3136.3594,581.0156 L3137.4063,584.6719 L3136.0781,585.0781 Q3135.6094,583.5313 3134.9453,582.8672 Q3134.2813,582.2031 3133.2188,582.2031 Q3132.8281,582.2031 3132.0625,583.7344 Q3131.2969,585.2656 3131.2969,587.5156 Q3131.2969,589.9844 3131.9609,591.375 Q3132.625,592.7656 3133.1563,592.7656 Q3134.2188,592.7656 3134.9766,592 Q3135.7344,591.2344 3136.0781,589.5781 L3137.4063,590.1719 Q3137.0781,591.5781 3136.1797,592.4688 Q3135.2813,593.3594 3133.0781,593.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="176" x="3148.5" y="593.5576">AnonymousAuthenticationToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3120.5" x2="3326.5" y1="604" y2="604"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3127.5" y="614.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="3139.5" y="620.606">keyHash: int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3127.5" y="629.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="3139.5" y="635.6289">principal: Object</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3120.5" x2="3326.5" y1="642.0459" y2="642.0459"/><path d="M2978,795 L2978,822.7544 A0,0 0 0 0 2978,822.7544 L3429,822.7544 A0,0 0 0 0 3429,822.7544 L3429,805 L3419,795 L3208.87,795 L3219.6,650.256 L3200.87,795 L2978,795 A0,0 0 0 0 2978,795 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3419,795 L3419,805 L3429,805 L3419,795 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="430" x="2984" y="814.8979">跟 AnonymousAuthenticationProvider 配套，判断 key 是否相同，代表匿名</text><!--class AnonymousAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="AnonymousAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="219" x="2724" y="777.5"/><ellipse cx="2739" cy="793.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2737.5781,798.8594 Q2735.7188,798.8594 2734.625,797.4688 Q2733.5313,796.0781 2733.5313,793.0938 Q2733.5313,790.5625 2734.6953,788.9063 Q2735.8594,787.25 2737.8438,787.25 Q2739.3125,787.25 2739.7813,787.375 Q2740.25,787.5781 2740.25,787.5781 Q2740.25,787.5781 2740.25,787.5078 Q2740.25,787.4375 2740.8594,786.5156 L2741.9063,790.1719 L2740.5781,790.5781 Q2740.1094,789.0313 2739.4453,788.3672 Q2738.7813,787.7031 2737.7188,787.7031 Q2737.3281,787.7031 2736.5625,789.2344 Q2735.7969,790.7656 2735.7969,793.0156 Q2735.7969,795.4844 2736.4609,796.875 Q2737.125,798.2656 2737.6563,798.2656 Q2738.7188,798.2656 2739.4766,797.5 Q2740.2344,796.7344 2740.5781,795.0781 L2741.9063,795.6719 Q2741.5781,797.0781 2740.6797,797.9688 Q2739.7813,798.8594 2737.5781,798.8594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="187" x="2753" y="799.0576">AnonymousAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2725" x2="2942" y1="809.5" y2="809.5"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2732" y="819.5115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="51" x="2744" y="826.106">key: String</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2725" x2="2942" y1="832.5229" y2="832.5229"/><!--class RunAsUserToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="108.0918" id="RunAsUserToken" style="stroke: #A80036; stroke-width: 1.5;" width="294" x="1334.5" y="557"/><ellipse cx="1428.25" cy="573" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1426.8281,578.3594 Q1424.9688,578.3594 1423.875,576.9688 Q1422.7813,575.5781 1422.7813,572.5938 Q1422.7813,570.0625 1423.9453,568.4063 Q1425.1094,566.75 1427.0938,566.75 Q1428.5625,566.75 1429.0313,566.875 Q1429.5,567.0781 1429.5,567.0781 Q1429.5,567.0781 1429.5,567.0078 Q1429.5,566.9375 1430.1094,566.0156 L1431.1563,569.6719 L1429.8281,570.0781 Q1429.3594,568.5313 1428.6953,567.8672 Q1428.0313,567.2031 1426.9688,567.2031 Q1426.5781,567.2031 1425.8125,568.7344 Q1425.0469,570.2656 1425.0469,572.5156 Q1425.0469,574.9844 1425.7109,576.375 Q1426.375,577.7656 1426.9063,577.7656 Q1427.9688,577.7656 1428.7266,577 Q1429.4844,576.2344 1429.8281,574.5781 L1431.1563,575.1719 Q1430.8281,576.5781 1429.9297,577.4688 Q1429.0313,578.3594 1426.8281,578.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="98" x="1448.75" y="578.5576">RunAsUserToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1335.5" x2="1627.5" y1="589" y2="589"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1342.5" y="599.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="1354.5" y="605.606">keyHash: int</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1342.5" y="614.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="1354.5" y="620.6289">principal: Object</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1342.5" y="629.0574"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="1354.5" y="635.6519">credentials: Object</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1342.5" y="644.0803"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="268" x="1354.5" y="650.6748">originalAuthentication: Class&lt;? extends Authentication&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1335.5" x2="1627.5" y1="657.0918" y2="657.0918"/><path d="M426.5,795 L426.5,822.7544 L932.5,822.7544 L932.5,805 L922.5,795 L426.5,795 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M922.5,795 L922.5,805 L932.5,805 L922.5,795 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="485" x="432.5" y="814.8979">跟 RunAsImplAuthenticationProvider 配套，只要key 一样，外面传的角色就是有效的</text><!--class RunAsImplAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="RunAsImplAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="215" x="1708" y="777.5"/><ellipse cx="1723" cy="793.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1721.5781,798.8594 Q1719.7188,798.8594 1718.625,797.4688 Q1717.5313,796.0781 1717.5313,793.0938 Q1717.5313,790.5625 1718.6953,788.9063 Q1719.8594,787.25 1721.8438,787.25 Q1723.3125,787.25 1723.7813,787.375 Q1724.25,787.5781 1724.25,787.5781 Q1724.25,787.5781 1724.25,787.5078 Q1724.25,787.4375 1724.8594,786.5156 L1725.9063,790.1719 L1724.5781,790.5781 Q1724.1094,789.0313 1723.4453,788.3672 Q1722.7813,787.7031 1721.7188,787.7031 Q1721.3281,787.7031 1720.5625,789.2344 Q1719.7969,790.7656 1719.7969,793.0156 Q1719.7969,795.4844 1720.4609,796.875 Q1721.125,798.2656 1721.6563,798.2656 Q1722.7188,798.2656 1723.4766,797.5 Q1724.2344,796.7344 1724.5781,795.0781 L1725.9063,795.6719 Q1725.5781,797.0781 1724.6797,797.9688 Q1723.7813,798.8594 1721.5781,798.8594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="183" x="1737" y="799.0576">RunAsImplAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1709" x2="1922" y1="809.5" y2="809.5"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1716" y="819.5115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="51" x="1728" y="826.106">key: String</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1709" x2="1922" y1="832.5229" y2="832.5229"/><!--class PreAuthenticatedAuthenticationToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="PreAuthenticatedAuthenticationToken" style="stroke: #A80036; stroke-width: 1.5;" width="236" x="3665.5" y="572"/><ellipse cx="3680.5" cy="588" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3679.0781,593.3594 Q3677.2188,593.3594 3676.125,591.9688 Q3675.0313,590.5781 3675.0313,587.5938 Q3675.0313,585.0625 3676.1953,583.4063 Q3677.3594,581.75 3679.3438,581.75 Q3680.8125,581.75 3681.2813,581.875 Q3681.75,582.0781 3681.75,582.0781 Q3681.75,582.0781 3681.75,582.0078 Q3681.75,581.9375 3682.3594,581.0156 L3683.4063,584.6719 L3682.0781,585.0781 Q3681.6094,583.5313 3680.9453,582.8672 Q3680.2813,582.2031 3679.2188,582.2031 Q3678.8281,582.2031 3678.0625,583.7344 Q3677.2969,585.2656 3677.2969,587.5156 Q3677.2969,589.9844 3677.9609,591.375 Q3678.625,592.7656 3679.1563,592.7656 Q3680.2188,592.7656 3680.9766,592 Q3681.7344,591.2344 3682.0781,589.5781 L3683.4063,590.1719 Q3683.0781,591.5781 3682.1797,592.4688 Q3681.2813,593.3594 3679.0781,593.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="204" x="3694.5" y="593.5576">PreAuthenticatedAuthenticationToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3666.5" x2="3900.5" y1="604" y2="604"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3673.5" y="614.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="3685.5" y="620.606">principal: Object</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3673.5" y="629.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="3685.5" y="635.6289">credentials: Object</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3666.5" x2="3900.5" y1="642.0459" y2="642.0459"/><!--class UserDetails--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="153.1606" id="UserDetails" style="stroke: #A80036; stroke-width: 1.5;" width="299" x="4062" y="344"/><ellipse cx="4175.25" cy="360" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4171.8438,354.2813 L4171.8438,353.875 L4178.1563,353.875 L4178.1563,354.2813 L4175.625,354.2813 Q4175.625,354.2813 4175.7734,354.4141 Q4175.9219,354.5469 4175.9219,354.8125 L4175.9219,364.2969 Q4175.9219,364.5625 4176.1406,364.6953 Q4176.3594,364.8281 4176.3594,364.8281 L4178.1563,364.8281 L4178.1563,365.2344 L4171.8438,365.2344 L4171.8438,364.8281 L4173.375,364.8281 Q4173.7031,364.8281 4173.8359,364.6953 Q4173.9688,364.5625 4173.9688,364.2969 L4173.9688,354.8125 Q4173.9688,354.5469 4173.8359,354.4141 Q4173.7031,354.2813 4173.375,354.2813 L4171.8438,354.2813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="64" x="4195.75" y="365.5576">UserDetails</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4063" x2="4360" y1="376" y2="376"/><ellipse cx="4073" cy="389.0115" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="4082" y="392.606">isCredentialsNonExpired: boolean</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4063" x2="4360" y1="399.0229" y2="399.0229"/><ellipse cx="4073" cy="412.0344" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="273" x="4082" y="415.6289">getAuthorities(): Collection&lt;? extends GrantedAuthority&gt;</text><ellipse cx="4073" cy="427.0574" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="107" x="4082" y="430.6519">getPassword(): String</text><ellipse cx="4073" cy="442.0803" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="106" x="4082" y="445.6748">getUsername(): String</text><ellipse cx="4073" cy="457.1033" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="156" x="4082" y="460.6978">isAccountNonExpired(): boolean</text><ellipse cx="4073" cy="472.1262" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="155" x="4082" y="475.7207">isAccountNonLocked(): boolean</text><ellipse cx="4073" cy="487.1492" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="98" x="4082" y="490.7437">isEnabled(): boolean</text><!--class AuthenticationUserDetailsService--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="AuthenticationUserDetailsService" style="stroke: #A80036; stroke-width: 1.5;" width="353" x="4503" y="579.5"/><ellipse cx="4518" cy="595.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4514.5938,589.7813 L4514.5938,589.375 L4520.9063,589.375 L4520.9063,589.7813 L4518.375,589.7813 Q4518.375,589.7813 4518.5234,589.9141 Q4518.6719,590.0469 4518.6719,590.3125 L4518.6719,599.7969 Q4518.6719,600.0625 4518.8906,600.1953 Q4519.1094,600.3281 4519.1094,600.3281 L4520.9063,600.3281 L4520.9063,600.7344 L4514.5938,600.7344 L4514.5938,600.3281 L4516.125,600.3281 Q4516.4531,600.3281 4516.5859,600.1953 Q4516.7188,600.0625 4516.7188,599.7969 L4516.7188,590.3125 Q4516.7188,590.0469 4516.5859,589.9141 Q4516.4531,589.7813 4516.125,589.7813 L4514.5938,589.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="183" x="4532" y="601.0576">AuthenticationUserDetailsService</text><rect fill="#FFFFFF" height="18.3887" style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" width="136" x="4723" y="576.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="134" x="4724" y="591.252">T extends Authentication</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4504" x2="4855" y1="611.5" y2="611.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="4504" x2="4855" y1="619.5" y2="619.5"/><ellipse cx="4514" cy="632.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="179" x="4523" y="636.106">loadUserDetails(T token): UserDetails</text><!--class UserDetailsChecker--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="UserDetailsChecker" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="4007.5" y="579.5"/><ellipse cx="4030.15" cy="595.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4026.7438,589.7813 L4026.7438,589.375 L4033.0563,589.375 L4033.0563,589.7813 L4030.525,589.7813 Q4030.525,589.7813 4030.6734,589.9141 Q4030.8219,590.0469 4030.8219,590.3125 L4030.8219,599.7969 Q4030.8219,600.0625 4031.0406,600.1953 Q4031.2594,600.3281 4031.2594,600.3281 L4033.0563,600.3281 L4033.0563,600.7344 L4026.7438,600.7344 L4026.7438,600.3281 L4028.275,600.3281 Q4028.6031,600.3281 4028.7359,600.1953 Q4028.8688,600.0625 4028.8688,599.7969 L4028.8688,590.3125 Q4028.8688,590.0469 4028.7359,589.9141 Q4028.6031,589.7813 4028.275,589.7813 L4026.7438,589.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="111" x="4045.85" y="601.0576">UserDetailsChecker</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4008.5" x2="4166.5" y1="611.5" y2="611.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="4008.5" x2="4166.5" y1="619.5" y2="619.5"/><ellipse cx="4018.5" cy="632.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="134" x="4027.5" y="636.106">check(UserDetails toCheck)</text><!--class PreAuthenticatedAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="93.0688" id="PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="500" x="4162.5" y="762.5"/><ellipse cx="4300.75" cy="778.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4299.3281,783.8594 Q4297.4688,783.8594 4296.375,782.4688 Q4295.2813,781.0781 4295.2813,778.0938 Q4295.2813,775.5625 4296.4453,773.9063 Q4297.6094,772.25 4299.5938,772.25 Q4301.0625,772.25 4301.5313,772.375 Q4302,772.5781 4302,772.5781 Q4302,772.5781 4302,772.5078 Q4302,772.4375 4302.6094,771.5156 L4303.6563,775.1719 L4302.3281,775.5781 Q4301.8594,774.0313 4301.1953,773.3672 Q4300.5313,772.7031 4299.4688,772.7031 Q4299.0781,772.7031 4298.3125,774.2344 Q4297.5469,775.7656 4297.5469,778.0156 Q4297.5469,780.4844 4298.2109,781.875 Q4298.875,783.2656 4299.4063,783.2656 Q4300.4688,783.2656 4301.2266,782.5 Q4301.9844,781.7344 4302.3281,780.0781 L4303.6563,780.6719 Q4303.3281,782.0781 4302.4297,782.9688 Q4301.5313,783.8594 4299.3281,783.8594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="215" x="4321.25" y="784.0576">PreAuthenticatedAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4163.5" x2="4661.5" y1="794.5" y2="794.5"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="4170.5" y="804.5115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="474" x="4182.5" y="811.106">preAuthenticatedUserDetailsService: AuthenticationUserDetailsService&lt;T extends Authentication&gt;</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="4170.5" y="819.5344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="195" x="4182.5" y="826.1289">userDetailsChecker: UserDetailsChecker</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="4170.5" y="834.5574"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="4182.5" y="841.1519">throwExceptionWhenTokenRejected: boolean</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4163.5" x2="4661.5" y1="847.5688" y2="847.5688"/><path d="M4211,978 L4211,1005.7544 A0,0 0 0 0 4211,1005.7544 L4808,1005.7544 A0,0 0 0 0 4808,1005.7544 L4808,988 L4798,978 L4506.42,978 L4436.98,855.674 L4498.42,978 L4211,978 A0,0 0 0 0 4211,978 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4798,978 L4798,988 L4808,988 L4798,978 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="576" x="4217" y="997.8979">这个是 web 应用的前置认证提供类，凭证信息是用 http request 里面获取的，具体的可以看源码说明</text><!--class UsernamePasswordAuthenticationToken--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="UsernamePasswordAuthenticationToken" style="stroke: #A80036; stroke-width: 1.5;" width="258" x="2263.5" y="572"/><ellipse cx="2278.5" cy="588" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2277.0781,593.3594 Q2275.2188,593.3594 2274.125,591.9688 Q2273.0313,590.5781 2273.0313,587.5938 Q2273.0313,585.0625 2274.1953,583.4063 Q2275.3594,581.75 2277.3438,581.75 Q2278.8125,581.75 2279.2813,581.875 Q2279.75,582.0781 2279.75,582.0781 Q2279.75,582.0781 2279.75,582.0078 Q2279.75,581.9375 2280.3594,581.0156 L2281.4063,584.6719 L2280.0781,585.0781 Q2279.6094,583.5313 2278.9453,582.8672 Q2278.2813,582.2031 2277.2188,582.2031 Q2276.8281,582.2031 2276.0625,583.7344 Q2275.2969,585.2656 2275.2969,587.5156 Q2275.2969,589.9844 2275.9609,591.375 Q2276.625,592.7656 2277.1563,592.7656 Q2278.2188,592.7656 2278.9766,592 Q2279.7344,591.2344 2280.0781,589.5781 L2281.4063,590.1719 Q2281.0781,591.5781 2280.1797,592.4688 Q2279.2813,593.3594 2277.0781,593.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="226" x="2292.5" y="593.5576">UsernamePasswordAuthenticationToken</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2264.5" x2="2520.5" y1="604" y2="604"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2271.5" y="614.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="2283.5" y="620.606">principal: Object</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="2271.5" y="629.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="2283.5" y="635.6289">credentials: Object</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2264.5" x2="2520.5" y1="642.0459" y2="642.0459"/><!--class UserCache--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="93.0688" id="UserCache" style="stroke: #A80036; stroke-width: 1.5;" width="267" x="3363" y="564.5"/><ellipse cx="3461.25" cy="580.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3457.8438,574.7813 L3457.8438,574.375 L3464.1563,574.375 L3464.1563,574.7813 L3461.625,574.7813 Q3461.625,574.7813 3461.7734,574.9141 Q3461.9219,575.0469 3461.9219,575.3125 L3461.9219,584.7969 Q3461.9219,585.0625 3462.1406,585.1953 Q3462.3594,585.3281 3462.3594,585.3281 L3464.1563,585.3281 L3464.1563,585.7344 L3457.8438,585.7344 L3457.8438,585.3281 L3459.375,585.3281 Q3459.7031,585.3281 3459.8359,585.1953 Q3459.9688,585.0625 3459.9688,584.7969 L3459.9688,575.3125 Q3459.9688,575.0469 3459.8359,574.9141 Q3459.7031,574.7813 3459.375,574.7813 L3457.8438,574.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="62" x="3481.75" y="586.0576">UserCache</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3364" x2="3629" y1="596.5" y2="596.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="3364" x2="3629" y1="604.5" y2="604.5"/><ellipse cx="3374" cy="617.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="241" x="3383" y="621.106">getUserFromCache(String username): UserDetails</text><ellipse cx="3374" cy="632.5344" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="165" x="3383" y="636.1289">putUserInCache(UserDetails user)</text><ellipse cx="3374" cy="647.5574" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="201" x="3383" y="651.1519">removeUserFromCache(String username)</text><!--class GrantedAuthoritiesMapper--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="GrantedAuthoritiesMapper" style="stroke: #A80036; stroke-width: 1.5;" width="549" x="2556" y="183.5"/><ellipse cx="2754.75" cy="199.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2751.3438,193.7813 L2751.3438,193.375 L2757.6563,193.375 L2757.6563,193.7813 L2755.125,193.7813 Q2755.125,193.7813 2755.2734,193.9141 Q2755.4219,194.0469 2755.4219,194.3125 L2755.4219,203.7969 Q2755.4219,204.0625 2755.6406,204.1953 Q2755.8594,204.3281 2755.8594,204.3281 L2757.6563,204.3281 L2757.6563,204.7344 L2751.3438,204.7344 L2751.3438,204.3281 L2752.875,204.3281 Q2753.2031,204.3281 2753.3359,204.1953 Q2753.4688,204.0625 2753.4688,203.7969 L2753.4688,194.3125 Q2753.4688,194.0469 2753.3359,193.9141 Q2753.2031,193.7813 2752.875,193.7813 L2751.3438,193.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="143" x="2775.25" y="205.0576">GrantedAuthoritiesMapper</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="2557" x2="3104" y1="215.5" y2="215.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2557" x2="3104" y1="223.5" y2="223.5"/><ellipse cx="2567" cy="236.5115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="523" x="2576" y="240.106">mapAuthorities(Collection&lt;? extends GrantedAuthority&gt; authorities): Collection&lt;? extends GrantedAuthority&gt;</text><!--class AbstractUserDetailsAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="168.1836" id="AbstractUserDetailsAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="566" x="3464.5" y="725"/><ellipse cx="3626.75" cy="741" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3627.125,740.9844 L3625.1406,740.9844 L3624.5469,743.5 Q3624.4844,743.8438 3624.4844,744.0313 Q3624.4844,744.2969 3624.5781,744.5625 Q3624.6719,744.8281 3624.6719,744.8281 L3625.3438,744.8281 L3625.3438,745.2344 L3621.8906,745.2344 L3621.8906,744.8281 L3622.0781,744.8281 Q3622.3438,744.8281 3622.5469,744.6641 Q3622.75,744.5 3622.8125,744.1094 L3625.4063,733.9375 L3627.2813,733.3281 L3629.9219,744.1094 Q3630.0625,744.5 3630.2578,744.6641 Q3630.4531,744.8281 3630.4531,744.8281 L3630.9219,744.8281 L3630.9219,745.2344 L3627.0625,745.2344 L3627.0625,744.8281 L3627.3281,744.8281 Q3627.7344,744.8281 3627.7969,744.6641 Q3627.8594,744.5 3627.8594,744.375 Q3627.8594,744.1094 3627.7969,743.9063 L3627.125,740.9844 Z M3625.7344,735.0781 L3625.7344,735.0781 L3625.2813,740.5781 L3627.0625,740.5781 L3625.7344,735.0781 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="233" x="3647.25" y="746.5576">AbstractUserDetailsAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3465.5" x2="4029.5" y1="757" y2="757"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="767.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="3484.5" y="773.606">userCache: UserCache</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="782.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="152" x="3484.5" y="788.6289">forcePrincipalAsString: boolean</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="797.0574"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="3484.5" y="803.6519">hideUserNotFoundExceptions: boolean</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="812.0803"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="222" x="3484.5" y="818.6748">preAuthenticationChecks: UserDetailsChecker</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="827.1033"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="227" x="3484.5" y="833.6978">postAuthenticationChecks: UserDetailsChecker</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3472.5" y="842.1262"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="219" x="3484.5" y="848.7207">authoritiesMapper: GrantedAuthoritiesMapper</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3465.5" x2="4029.5" y1="855.1377" y2="855.1377"/><polygon fill="#FFFF44" points="3475.5,863.1492,3479.5,867.1492,3475.5,871.1492,3471.5,867.1492" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="540" x="3484.5" y="871.7437">additionalAuthenticationChecks(UserDetails userDetails,UsernamePasswordAuthenticationToken authentication)</text><polygon fill="#FFFF44" points="3475.5,878.1721,3479.5,882.1721,3475.5,886.1721,3471.5,882.1721" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="481" x="3484.5" y="886.7666">retrieveUser(String username, UsernamePasswordAuthenticationToken authentication): UserDetails</text><path d="M3319,978 L3319,1005.7544 A0,0 0 0 0 3319,1005.7544 L4176,1005.7544 A0,0 0 0 0 4176,1005.7544 L4176,988 L4166,978 L3751.5,978 L3747.5,893.084 L3743.5,978 L3319,978 A0,0 0 0 0 3319,978 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4166,978 L4166,988 L4176,988 L4166,978 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="836" x="3325" y="997.8979">这个类是处理 用户名，密码类型的凭证，通常用在后台管理系统里面，对使用者来说，需要提供 UserDetailsService 的实现，作为数据源就可以了</text><!--class PasswordEncoder--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="PasswordEncoder" style="stroke: #A80036; stroke-width: 1.5;" width="349" x="4576" y="8"/><ellipse cx="4696.75" cy="24" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4693.3438,18.2813 L4693.3438,17.875 L4699.6563,17.875 L4699.6563,18.2813 L4697.125,18.2813 Q4697.125,18.2813 4697.2734,18.4141 Q4697.4219,18.5469 4697.4219,18.8125 L4697.4219,28.2969 Q4697.4219,28.5625 4697.6406,28.6953 Q4697.8594,28.8281 4697.8594,28.8281 L4699.6563,28.8281 L4699.6563,29.2344 L4693.3438,29.2344 L4693.3438,28.8281 L4694.875,28.8281 Q4695.2031,28.8281 4695.3359,28.6953 Q4695.4688,28.5625 4695.4688,28.2969 L4695.4688,18.8125 Q4695.4688,18.5469 4695.3359,18.4141 Q4695.2031,18.2813 4694.875,18.2813 L4693.3438,18.2813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="99" x="4717.25" y="29.5576">PasswordEncoder</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4577" x2="4924" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="4577" x2="4924" y1="48" y2="48"/><ellipse cx="4587" cy="61.0115" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="179" x="4596" y="64.606">encode(String rawPassword): String</text><ellipse cx="4587" cy="76.0344" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="323" x="4596" y="79.6289">matches(String rawPassword, String encodedPassword): boolean</text><path d="M4292.5,201 L4292.5,228.7544 A0,0 0 0 0 4292.5,228.7544 L4566.5,228.7544 A0,0 0 0 0 4566.5,228.7544 L4566.5,211 L4556.5,201 L4458.82,201 L4676.86,86.08 L4450.82,201 L4292.5,201 A0,0 0 0 0 4292.5,201 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4556.5,201 L4556.5,211 L4566.5,211 L4556.5,201 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="4298.5" y="220.8979">密码存储通常不是明文的，大部分都是 hash</text><!--class DelegatingPasswordEncoder--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="DelegatingPasswordEncoder" style="stroke: #A80036; stroke-width: 1.5;" width="298" x="4601.5" y="176"/><ellipse cx="4665.25" cy="192" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4663.8281,197.3594 Q4661.9688,197.3594 4660.875,195.9688 Q4659.7813,194.5781 4659.7813,191.5938 Q4659.7813,189.0625 4660.9453,187.4063 Q4662.1094,185.75 4664.0938,185.75 Q4665.5625,185.75 4666.0313,185.875 Q4666.5,186.0781 4666.5,186.0781 Q4666.5,186.0781 4666.5,186.0078 Q4666.5,185.9375 4667.1094,185.0156 L4668.1563,188.6719 L4666.8281,189.0781 Q4666.3594,187.5313 4665.6953,186.8672 Q4665.0313,186.2031 4663.9688,186.2031 Q4663.5781,186.2031 4662.8125,187.7344 Q4662.0469,189.2656 4662.0469,191.5156 Q4662.0469,193.9844 4662.7109,195.375 Q4663.375,196.7656 4663.9063,196.7656 Q4664.9688,196.7656 4665.7266,196 Q4666.4844,195.2344 4666.8281,193.5781 L4668.1563,194.1719 Q4667.8281,195.5781 4666.9297,196.4688 Q4666.0313,197.3594 4663.8281,197.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="4685.75" y="197.5576">DelegatingPasswordEncoder</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4602.5" x2="4898.5" y1="208" y2="208"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="4609.5" y="218.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="238" x="4621.5" y="224.606">passwordEncoderForEncode: PasswordEncoder</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="4609.5" y="233.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="272" x="4621.5" y="239.6289">idToPasswordEncoder: Map&lt;String, PasswordEncoder&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4602.5" x2="4898.5" y1="246.0459" y2="246.0459"/><path d="M4396.5,406.5 L4396.5,434.2544 A0,0 0 0 0 4396.5,434.2544 L5104.5,434.2544 A0,0 0 0 0 5104.5,434.2544 L5104.5,416.5 L5094.5,406.5 L4754.5,406.5 L4750.5,254.277 L4746.5,406.5 L4396.5,406.5 A0,0 0 0 0 4396.5,406.5 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M5094.5,406.5 L5094.5,416.5 L5104.5,416.5 L5094.5,406.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="687" x="4402.5" y="426.3979">这里里面是默认的实现，里面有一个 PasswordEncoder 的列表，用来提供各种类型的 hash 策略，通常推荐的是 BCrypt</text><!--class UserDetailsService--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="63.0229" id="UserDetailsService" style="stroke: #A80036; stroke-width: 1.5;" width="265" x="4203" y="579.5"/><ellipse cx="4278.75" cy="595.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M4275.3438,589.7813 L4275.3438,589.375 L4281.6563,589.375 L4281.6563,589.7813 L4279.125,589.7813 Q4279.125,589.7813 4279.2734,589.9141 Q4279.4219,590.0469 4279.4219,590.3125 L4279.4219,599.7969 Q4279.4219,600.0625 4279.6406,600.1953 Q4279.8594,600.3281 4279.8594,600.3281 L4281.6563,600.3281 L4281.6563,600.7344 L4275.3438,600.7344 L4275.3438,600.3281 L4276.875,600.3281 Q4277.2031,600.3281 4277.3359,600.1953 Q4277.4688,600.0625 4277.4688,599.7969 L4277.4688,590.3125 Q4277.4688,590.0469 4277.3359,589.9141 Q4277.2031,589.7813 4276.875,589.7813 L4275.3438,589.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="105" x="4299.25" y="601.0576">UserDetailsService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="4204" x2="4467" y1="611.5" y2="611.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="4204" x2="4467" y1="619.5" y2="619.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="253" x="4209" y="636.106">loadUserByUsername(String username): UserDetails</text><!--class DaoAuthenticationProvider--><rect fill="#FEFECE" filter="url(#fpicdn1crim74)" height="78.0459" id="DaoAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.5;" width="215" x="3069" y="953"/><ellipse cx="3101.1" cy="969" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3099.6781,974.3594 Q3097.8188,974.3594 3096.725,972.9688 Q3095.6313,971.5781 3095.6313,968.5938 Q3095.6313,966.0625 3096.7953,964.4063 Q3097.9594,962.75 3099.9438,962.75 Q3101.4125,962.75 3101.8813,962.875 Q3102.35,963.0781 3102.35,963.0781 Q3102.35,963.0781 3102.35,963.0078 Q3102.35,962.9375 3102.9594,962.0156 L3104.0063,965.6719 L3102.6781,966.0781 Q3102.2094,964.5313 3101.5453,963.8672 Q3100.8813,963.2031 3099.8188,963.2031 Q3099.4281,963.2031 3098.6625,964.7344 Q3097.8969,966.2656 3097.8969,968.5156 Q3097.8969,970.9844 3098.5609,972.375 Q3099.225,973.7656 3099.7563,973.7656 Q3100.8188,973.7656 3101.5766,973 Q3102.3344,972.2344 3102.6781,970.5781 L3104.0063,971.1719 Q3103.6781,972.5781 3102.7797,973.4688 Q3101.8813,974.3594 3099.6781,974.3594 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="145" x="3118.9" y="974.5576">DaoAuthenticationProvider</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3070" x2="3283" y1="985" y2="985"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3077" y="995.0115"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="3089" y="1001.606">passwordEncoder: PasswordEncoder</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="3077" y="1010.0344"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="3089" y="1016.6289">userDetailsService: UserDetailsService</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="3070" x2="3283" y1="1023.0459" y2="1023.0459"/><path d="M2821.5,1091 L2821.5,1118.7544 A0,0 0 0 0 2821.5,1118.7544 L3531.5,1118.7544 A0,0 0 0 0 3531.5,1118.7544 L3531.5,1101 L3521.5,1091 L3180.5,1091 L3176.5,1031.1999 L3172.5,1091 L2821.5,1091 A0,0 0 0 0 2821.5,1091 " fill="#FBFB77" filter="url(#fpicdn1crim74)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3521.5,1091 L3521.5,1101 L3531.5,1101 L3521.5,1091 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="689" x="2827.5" y="1110.8979">这个就是默认处理 UsernamePasswordAuthenticationToken 的一个 provider ，需要用户自定义 hash 策略 和 用户数据源</text><!--link GrantedAuthority to GMN7--><path d="M2566.1,54.58 C2679.17,67.03 2922.1,97.27 3122.5,146 C3184.08,160.973 3253.69,185.812 3293.9,200.965 " fill="none" id="GrantedAuthority-GMN7" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link Principal to Authentication--><path d="M1866.32,94.99 C1878.02,110.78 1891.33,128.742 1903.99,145.833 " fill="none" id="Principal-Authentication" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1860.63,99.07,1854.35,78.83,1871.88,90.74,1860.63,99.07" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GrantedAuthority to Authentication--><path d="M2426.23,71.1 C2343.26,96.24 2208.55,137.043 2104.28,168.627 " fill="none" id="GrantedAuthority-Authentication" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2438.83,67.29,2431.9277,65.2024,2427.3459,70.7708,2434.2482,72.8584,2438.83,67.29" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationManager to GMN17--><path d="M921.85,628.787 C785.359,645.875 581.302,676.783 408.5,725 C341.098,743.807 265.592,776.74 226.054,794.956 " fill="none" id="AuthenticationManager-GMN17" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link Authentication to AuthenticationManager--><path d="M1792.26,282.345 C1790.67,282.903 1789.08,283.455 1787.5,284 C1695.32,315.765 1666.95,307.604 1576.5,344 C1403.6,413.573 1212.54,525.651 1124.66,579.368 " fill="none" id="Authentication-AuthenticationManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1804.58,277.949,1797.5844,276.1993,1793.2786,281.9838,1800.2743,283.7335,1804.58,277.949" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to ProviderManager--><path d="M1950.62,653.601 C1934.56,657.98 1918.23,661.941 1902.5,665 C1595.12,724.78 1496.16,621.841 1200.5,725 C1171.85,734.998 1143.38,753.085 1120.87,769.828 " fill="none" id="AuthenticationProvider-ProviderManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1963.43,650.01,1956.5721,647.7809,1951.8768,653.254,1958.7347,655.4831,1963.43,650.01" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationManager to ProviderManager--><path d="M1075.5,662.98 C1075.5,696.403 1075.5,739.389 1075.5,769.86 " fill="none" id="AuthenticationManager-ProviderManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1068.5,662.625,1075.5,642.625,1082.5,662.625,1068.5,662.625" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Authentication to AbstractAuthenticationToken--><path d="M2119.47,292.645 C2178.43,320.039 2242.96,350.022 2294.48,373.957 " fill="none" id="Authentication-AbstractAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2116.15,298.821,2100.96,284.045,2122.04,286.124,2116.15,298.821" style="stroke: #A80036; stroke-width: 1.0;"/><!--link CredentialsContainer to AbstractAuthenticationToken--><path d="M2379,266.922 C2381.91,299.787 2385.66,342.172 2388.47,373.926 " fill="none" id="CredentialsContainer-AbstractAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2372.02,267.446,2377.23,246.907,2385.97,266.213,2372.02,267.446" style="stroke: #A80036; stroke-width: 1.0;"/><!--link RememberMeAuthenticationToken to RememberMeAuthenticationProvider--><path d="M1843.88,657.328 C1896.11,691.451 1966.89,737.695 2016.21,769.916 " fill="none" id="RememberMeAuthenticationToken-RememberMeAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1832.7,650.023,1835.5338,656.6539,1842.7446,656.5885,1839.9108,649.9575,1832.7,650.023" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to RememberMeAuthenticationProvider--><path d="M2074.5,670.698 C2074.5,702.81 2074.5,741.67 2074.5,769.84 " fill="none" id="AuthenticationProvider-RememberMeAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2067.5,670.256,2074.5,650.256,2081.5,670.256,2067.5,670.256" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AnonymousAuthenticationToken to AnonymousAuthenticationProvider--><path d="M3124.17,655.223 C3116.5,658.538 3108.88,661.827 3101.5,665 C3038.93,691.902 3020.57,692.913 2960.5,725 C2931.34,740.574 2900.25,760.826 2876.13,777.426 " fill="none" id="AnonymousAuthenticationToken-AnonymousAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3136.23,650.006,3129.1341,648.722,3125.2197,654.7782,3132.3156,656.0622,3136.23,650.006" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to AnonymousAuthenticationProvider--><path d="M2207.24,655.561 C2220.09,659.047 2233,662.27 2245.5,665 C2447.36,709.079 2512.7,653.348 2706.5,725 C2739.36,737.149 2772.35,759.077 2796.47,777.344 " fill="none" id="AuthenticationProvider-AnonymousAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2205.19,662.255,2187.83,650.097,2208.98,648.779,2205.19,662.255" style="stroke: #A80036; stroke-width: 1.0;"/><!--link RunAsUserToken to GMN53--><path d="M1334.32,645.728 C1305.24,652.241 1274.93,658.924 1246.5,665 C1114.81,693.149 1080.02,691.841 949.5,725 C865.847,746.252 769.6,777.513 717.614,794.976 " fill="none" id="RunAsUserToken-GMN53" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link GrantedAuthority to RunAsUserToken--><path d="M2419.59,66.02 C2373,80.25 2317.38,104.82 2282.5,146 C2178.35,268.979 2313.37,391.551 2191.5,497 C2099.19,576.869 1764.86,531.434 1645.5,557 C1639.94,558.191 1634.3,559.497 1628.63,560.894 " fill="none" id="GrantedAuthority-RunAsUserToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2417.77,59.26,2438.92,60.53,2421.59,72.72,2417.77,59.26" style="stroke: #A80036; stroke-width: 1.0;"/><!--link RunAsUserToken to RunAsImplAuthenticationProvider--><path d="M1594.98,671.392 C1625.93,688.203 1659.26,706.871 1689.5,725 C1717.13,741.567 1747.3,761.375 1771.19,777.485 " fill="none" id="RunAsUserToken-RunAsImplAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1583.24,665.045,1586.6143,671.4179,1593.7948,670.7542,1590.4205,664.3813,1583.24,665.045" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to RunAsImplAuthenticationProvider--><path d="M2008.26,662.127 C1960.13,698.547 1896.55,746.662 1855.83,777.477 " fill="none" id="AuthenticationProvider-RunAsImplAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2004.08,656.51,2024.26,650.023,2012.53,667.674,2004.08,656.51" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GrantedAuthority to UserDetails--><path d="M2494.74,91.83 C2488.02,145.547 2486.34,235.394 2538.5,284 C2648.69,386.681 3672.11,411.887 4061.8,417.786 " fill="none" id="GrantedAuthority-UserDetails" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2496.58,78.68,2491.7884,84.0689,2494.9198,90.5646,2499.7115,85.1757,2496.58,78.68" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetails to AuthenticationUserDetailsService--><path d="M4373.1,494.757 C4374.91,495.511 4376.71,496.259 4378.5,497 C4450.33,526.685 4533.08,557.51 4593.61,579.452 " fill="none" id="UserDetails-AuthenticationUserDetailsService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4361.06,489.685,4365.0321,495.7035,4372.1154,494.3518,4368.1433,488.3333,4361.06,489.685" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetails to UserDetailsChecker--><path d="M4154.42,508.271 C4137.74,533.63 4120.58,559.717 4107.81,579.124 " fill="none" id="UserDetails-UserDetailsChecker" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4161.78,497.084,4155.1421,499.9014,4155.1897,507.1124,4161.8277,504.2949,4161.78,497.084" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetailsChecker to PreAuthenticatedAuthenticationProvider--><path d="M4149.63,649.468 C4203,681.653 4280.11,728.157 4337.02,762.479 " fill="none" id="UserDetailsChecker-PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4138.28,642.625,4141.3521,649.149,4148.5558,648.8224,4145.4837,642.2984,4138.28,642.625" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationUserDetailsService to PreAuthenticatedAuthenticationProvider--><path d="M4627.07,650.485 C4583.29,682.627 4520.78,728.517 4474.51,762.479 " fill="none" id="AuthenticationUserDetailsService-PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4637.78,642.625,4630.5761,642.9477,4628.1033,649.7216,4635.3072,649.3989,4637.78,642.625" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PreAuthenticatedAuthenticationToken to PreAuthenticatedAuthenticationProvider--><path d="M3914.44,652.801 C4017.07,684.783 4159.84,729.27 4266.22,762.418 " fill="none" id="PreAuthenticatedAuthenticationToken-PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3901.81,648.866,3906.3467,654.4712,3913.2656,652.4393,3908.7289,646.8341,3901.81,648.866" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetails to PreAuthenticatedAuthenticationProvider--><path d="M4373.97,495.703 C4375.48,496.146 4376.99,496.579 4378.5,497 C4485.21,526.834 4800.01,474.069 4873.5,557 C4905.33,592.925 4901.97,626.357 4873.5,665 C4844.33,704.592 4745,737.94 4645.97,762.446 " fill="none" id="UserDetails-PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4361.37,491.782,4365.9069,497.387,4372.8258,495.3549,4368.2888,489.7499,4361.37,491.782" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to PreAuthenticatedAuthenticationProvider--><path d="M2201.76,655.504 C2216.37,659.286 2231.17,662.586 2245.5,665 C3035.7,798.137 3252.77,622.36 4047.5,725 C4112.11,733.345 4182.09,747.882 4243.33,762.482 " fill="none" id="AuthenticationProvider-PreAuthenticatedAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2199.43,662.126,2181.99,650.087,2203.13,648.624,2199.43,662.126" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractAuthenticationToken to RememberMeAuthenticationToken--><path d="M2301.31,476.46 C2285.75,484.248 2269.45,491.473 2253.5,497 C2104.38,548.691 2055.19,513.414 1903.5,557 C1889.07,561.146 1874.07,566.392 1859.61,571.963 " fill="none" id="AbstractAuthenticationToken-RememberMeAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2298.21,470.182,2319.18,467.127,2304.69,482.591,2298.21,470.182" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractAuthenticationToken to AnonymousAuthenticationToken--><path d="M2524.39,437.815 C2668.39,457.669 2904.71,496.268 3101.5,557 C3115.07,561.188 3129.16,566.422 3142.74,571.959 " fill="none" id="AbstractAuthenticationToken-AnonymousAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2523.14,444.71,2504.27,435.08,2525.03,430.837,2523.14,444.71" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractAuthenticationToken to RunAsUserToken--><path d="M2303.8,476.382 C2287.55,484.473 2270.38,491.816 2253.5,497 C1993.93,576.718 1911.32,501.599 1645.5,557 C1639.93,558.16 1634.29,559.44 1628.61,560.815 " fill="none" id="AbstractAuthenticationToken-RunAsUserToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2300.72,470.09,2321.69,467.006,2307.22,482.49,2300.72,470.09" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractAuthenticationToken to UsernamePasswordAuthenticationToken--><path d="M2392.5,487.327 C2392.5,515.56 2392.5,547.546 2392.5,571.776 " fill="none" id="AbstractAuthenticationToken-UsernamePasswordAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2385.5,487.131,2392.5,467.131,2399.5,487.131,2385.5,487.131" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractAuthenticationToken to PreAuthenticatedAuthenticationToken--><path d="M2524.33,424.342 C2755.14,431.826 3246.08,458.946 3647.5,557 C3663.38,560.878 3679.89,566.167 3695.7,571.909 " fill="none" id="AbstractAuthenticationToken-PreAuthenticatedAuthenticationToken" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2523.92,431.333,2504.15,423.716,2524.36,417.339,2523.92,431.333" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GrantedAuthority to GrantedAuthoritiesMapper--><path d="M2574.8,84.59 C2633.36,114.23 2714.9,155.496 2770.03,183.398 " fill="none" id="GrantedAuthority-GrantedAuthoritiesMapper" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2563.04,78.64,2566.5869,84.9185,2573.7466,84.0592,2570.1997,77.7807,2563.04,78.64" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AuthenticationProvider to AbstractUserDetailsAuthenticationProvider--><path d="M2202.44,655.434 C2216.84,659.19 2231.4,662.504 2245.5,665 C2771.76,758.174 2918.84,640.123 3446.5,725 C3452.39,725.947 3458.32,726.966 3464.3,728.049 " fill="none" id="AuthenticationProvider-AbstractUserDetailsAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="2200.39,662.129,2182.96,650.073,2204.1,648.631,2200.39,662.129" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetails to AbstractUserDetailsAuthenticationProvider--><path d="M4055.36,504.535 C4032,520.344 4009.19,537.964 3989.5,557 C3948.21,596.931 3956.72,622.116 3918.5,665 C3899.96,685.802 3878.32,706.214 3856.8,724.81 " fill="none" id="UserDetails-AbstractUserDetailsAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4066.49,497.163,4059.2789,497.145,4056.4888,503.7944,4063.6999,503.8125,4066.49,497.163" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserCache to AbstractUserDetailsAuthenticationProvider--><path d="M3565.51,665.889 C3588.86,684.12 3615.5,704.925 3641.06,724.887 " fill="none" id="UserCache-AbstractUserDetailsAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="3555.03,657.706,3557.2974,664.5513,3564.4883,665.0912,3562.2209,658.2458,3555.03,657.706" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UsernamePasswordAuthenticationToken to AbstractUserDetailsAuthenticationProvider--><path d="M2497.6,654.109 C2511.2,658.38 2525.06,662.177 2538.5,665 C2934.29,748.162 3047.73,657.565 3446.5,725 C3452.38,725.994 3458.31,727.056 3464.27,728.178 " fill="none" id="UsernamePasswordAuthenticationToken-AbstractUserDetailsAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="2485.22,650.068,2489.679,655.7352,2496.6252,653.799,2492.1663,648.1317,2485.22,650.068" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PasswordEncoder to DelegatingPasswordEncoder--><path d="M4738.27,106.25 C4737.28,129.317 4737.71,155.194 4739.57,175.806 " fill="none" id="PasswordEncoder-DelegatingPasswordEncoder" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="4731.3,105.59,4739.58,86.08,4745.27,106.5,4731.3,105.59" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PasswordEncoder to DelegatingPasswordEncoder--><path d="M4763.08,99.28 C4764.58,123.982 4764.24,153.091 4762.07,175.806 " fill="none" id="PasswordEncoder-DelegatingPasswordEncoder" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4762.06,86.08,4758.5404,92.3739,4762.9965,98.0434,4766.516,91.7495,4762.06,86.08" style="stroke: #A80036; stroke-width: 1.0;"/><!--link UserDetails to UserDetailsService--><path d="M4268.58,508.271 C4285.26,533.63 4302.42,559.717 4315.19,579.124 " fill="none" id="UserDetails-UserDetailsService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="4261.22,497.084,4261.1723,504.2949,4267.8103,507.1124,4267.8579,499.9014,4261.22,497.084" style="stroke: #A80036; stroke-width: 1.0;"/><!--link AbstractUserDetailsAuthenticationProvider to DaoAuthenticationProvider--><path d="M3466.2,899.169 C3401.3,919.74 3336.12,940.403 3284.06,956.905 " fill="none" id="AbstractUserDetailsAuthenticationProvider-DaoAuthenticationProvider" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="3464.22,892.454,3485.4,893.084,3468.45,905.8,3464.22,892.454" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml

interface Principal {
    + getName(): String
}
note bottom: 这里通常是用户名

interface GrantedAuthority {
    + getAuthority(): String
}
note bottom: 字符串形式的权限表达式，不过在 spring-security 里面是角色

interface Authentication {
    + getAuthorities(): Collection<? extends GrantedAuthority>
    + getCredentials(): Object
    + getDetails(): Object
    + getPrincipal(): Object
    + isAuthenticated(): boolean
    + setAuthenticated(boolean isAuthenticated)
}
note bottom: 这个类，可以代表用户传过来的凭证（用户名密码之类的），也是认证处理过后的内部使用的凭证

Principal <|- - Authentication
GrantedAuthority *- - Authentication

interface AuthenticationManager {
    + authenticate(Authentication authentication): Authentication
}
note bottom: 认证管理，就是判断传过来的凭证是否有效，通常不会自己实现

Authentication *- - AuthenticationManager


interface AuthenticationProvider {
    + authenticate(Authentication authentication): Authentication
    + supports(Class<?> authentication): boolean
}
note bottom: 认证提供类，由于凭证可以是各种类型，每个提供者处理自己支持的凭证类型

class ProviderManager {
    - providers: List<AuthenticationProvider>
    - parent: AuthenticationManager
}
note bottom: 这个就是认证管理的内部实现，我们自定义的是 认证提供，用来处理自定义凭证，如果没有自定义，那也不用管这里

AuthenticationProvider *- - ProviderManager

AuthenticationManager <|- - ProviderManager

interface CredentialsContainer {
    + eraseCredentials()
}

abstract class AbstractAuthenticationToken {
    - authorities: Collection<GrantedAuthority>
    - details: Object
    - authenticated: boolean
}
note bottom: 这个是抽象的凭证类实现，凭证里面有权限（角色），明细（额外信息），是否认证通过

Authentication <|- - AbstractAuthenticationToken
CredentialsContainer <|- - AbstractAuthenticationToken

class RememberMeAuthenticationToken {
    - keyHash: int
    - principal: Object
}
note bottom: 跟 RememberMeAuthenticationProvider 是配套的，判断 keyHash 是否相同

class RememberMeAuthenticationProvider {
    - keyHash: int
    - principal: Object
}

RememberMeAuthenticationToken *- - RememberMeAuthenticationProvider
AuthenticationProvider <|- - RememberMeAuthenticationProvider


class AnonymousAuthenticationToken {
    - keyHash: int
    - principal: Object
}

note bottom: 跟 AnonymousAuthenticationProvider 配套，判断 key 是否相同，代表匿名

class AnonymousAuthenticationProvider {
    - key: String
}

AnonymousAuthenticationToken *- - AnonymousAuthenticationProvider
AuthenticationProvider <|- - AnonymousAuthenticationProvider


class RunAsUserToken {
    - keyHash: int
    - principal: Object
    - credentials: Object
    - originalAuthentication: Class<? extends Authentication>
}

note bottom: 跟 RunAsImplAuthenticationProvider 配套，只要key 一样，外面传的角色就是有效的

GrantedAuthority <|- - RunAsUserToken

class RunAsImplAuthenticationProvider {
    - key: String
}

RunAsUserToken *- - RunAsImplAuthenticationProvider
AuthenticationProvider <|- - RunAsImplAuthenticationProvider

class PreAuthenticatedAuthenticationToken {
    - principal: Object
    - credentials: Object
}

interface UserDetails {
    + getAuthorities(): Collection<? extends GrantedAuthority>
    + getPassword(): String
    + getUsername(): String
    + isAccountNonExpired(): boolean
    + isAccountNonLocked(): boolean
    + isCredentialsNonExpired: boolean
    + isEnabled(): boolean
}

GrantedAuthority *- - UserDetails

interface AuthenticationUserDetailsService<T extends Authentication> {
    + loadUserDetails(T token): UserDetails
}

UserDetails *- - AuthenticationUserDetailsService

interface UserDetailsChecker {
    + check(UserDetails toCheck)
}

UserDetails *- - UserDetailsChecker

class PreAuthenticatedAuthenticationProvider {
    - preAuthenticatedUserDetailsService: AuthenticationUserDetailsService<T extends Authentication>
    - userDetailsChecker: UserDetailsChecker
    - throwExceptionWhenTokenRejected: boolean
}

note bottom: 这个是 web 应用的前置认证提供类，凭证信息是用 http request 里面获取的，具体的可以看源码说明

UserDetailsChecker *- - PreAuthenticatedAuthenticationProvider
AuthenticationUserDetailsService *- - PreAuthenticatedAuthenticationProvider
PreAuthenticatedAuthenticationToken *- - PreAuthenticatedAuthenticationProvider
UserDetails *- - PreAuthenticatedAuthenticationProvider
AuthenticationProvider <|- - PreAuthenticatedAuthenticationProvider


class UsernamePasswordAuthenticationToken {
    - principal: Object
    - credentials: Object
}

AbstractAuthenticationToken <|- - RememberMeAuthenticationToken
AbstractAuthenticationToken <|- - AnonymousAuthenticationToken
AbstractAuthenticationToken <|- - RunAsUserToken
AbstractAuthenticationToken <|- - UsernamePasswordAuthenticationToken
AbstractAuthenticationToken <|- - PreAuthenticatedAuthenticationToken



interface UserCache {
    + getUserFromCache(String username): UserDetails
    + putUserInCache(UserDetails user)
    + removeUserFromCache(String username)
}

interface GrantedAuthoritiesMapper {
    + mapAuthorities(Collection<? extends GrantedAuthority> authorities): Collection<? extends GrantedAuthority>
}

GrantedAuthority *- - GrantedAuthoritiesMapper

abstract class AbstractUserDetailsAuthenticationProvider {
    - userCache: UserCache
    - forcePrincipalAsString: boolean
    - hideUserNotFoundExceptions: boolean
    - preAuthenticationChecks: UserDetailsChecker
    - postAuthenticationChecks: UserDetailsChecker
    - authoritiesMapper: GrantedAuthoritiesMapper

    # additionalAuthenticationChecks(UserDetails userDetails,UsernamePasswordAuthenticationToken authentication)
    # retrieveUser(String username, UsernamePasswordAuthenticationToken authentication): UserDetails
}
note bottom: 这个类是处理 用户名，密码类型的凭证，通常用在后台管理系统里面，对使用者来说，需要提供 UserDetailsService 的实现，作为数据源就可以了

AuthenticationProvider <|- - AbstractUserDetailsAuthenticationProvider
UserDetails *- - AbstractUserDetailsAuthenticationProvider
UserCache *- - AbstractUserDetailsAuthenticationProvider
UsernamePasswordAuthenticationToken *- - AbstractUserDetailsAuthenticationProvider

interface PasswordEncoder {
    + encode(String rawPassword): String
    + matches(String rawPassword, String encodedPassword): boolean
}
note bottom: 密码存储通常不是明文的，大部分都是 hash

class DelegatingPasswordEncoder {
    - passwordEncoderForEncode: PasswordEncoder
    - idToPasswordEncoder: Map<String, PasswordEncoder>
}
note bottom: 这里里面是默认的实现，里面有一个 PasswordEncoder 的列表，用来提供各种类型的 hash 策略，通常推荐的是 BCrypt

PasswordEncoder <|- - DelegatingPasswordEncoder
PasswordEncoder *- - DelegatingPasswordEncoder

interface UserDetailsService {
    loadUserByUsername(String username): UserDetails
}

UserDetails *- - UserDetailsService

class DaoAuthenticationProvider {
    - passwordEncoder: PasswordEncoder
    - userDetailsService: UserDetailsService
}
note bottom: 这个就是默认处理 UsernamePasswordAuthenticationToken 的一个 provider ，需要用户自定义 hash 策略 和 用户数据源

AbstractUserDetailsAuthenticationProvider <|- - DaoAuthenticationProvider
@enduml

PlantUML version 1.2018.03(Fri Apr 06 00:59:15 CST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 10+46
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>